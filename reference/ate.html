<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Use the g-formula or the IPW or the double robust estimator
to estimate the average treatment
    effect (absolute risk difference or ratio)
based on Cox regression with or without competing risks."><title>Average Treatment Effects Computation — ate • riskRegression</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Average Treatment Effects Computation — ate"><meta property="og:description" content="Use the g-formula or the IPW or the double robust estimator
to estimate the average treatment
    effect (absolute risk difference or ratio)
based on Cox regression with or without competing risks."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">riskRegression</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2022.09.29</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/IFAUC.html">Derivation of the Influence Function for AUC for competing risk data and survival data</a>
    <a class="dropdown-item" href="../articles/IFBrier.html">Influence function calculation for Brier score for event time data</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/tagteam/riskRegression/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Average Treatment Effects Computation</h1>
      <small class="dont-index">Source: <a href="https://github.com/tagteam/riskRegression/blob/HEAD/R/ate.R" class="external-link"><code>R/ate.R</code></a></small>
      <div class="d-none name"><code>ate.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Use the g-formula or the IPW or the double robust estimator
to estimate the average treatment
    effect (absolute risk difference or ratio)
based on Cox regression with or without competing risks.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">ate</span><span class="op">(</span></span>
<span>  <span class="va">event</span>,</span>
<span>  <span class="va">treatment</span>,</span>
<span>  censor <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  data.index <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">formula</span>,</span>
<span>  estimator <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  strata <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  contrasts <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  allContrasts <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">times</span>,</span>
<span>  cause <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  <span class="va">landmark</span>,</span>
<span>  se <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  iid <span class="op">=</span> <span class="op">(</span><span class="va">B</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="op">(</span><span class="va">se</span> <span class="op">||</span> <span class="va">band</span><span class="op">)</span>,</span>
<span>  known.nuisance <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  band <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  B <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  <span class="va">seed</span>,</span>
<span>  handler <span class="op">=</span> <span class="st">"foreach"</span>,</span>
<span>  mc.cores <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  cl <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>event</dt>
<dd><p>Outcome model which describes how the probability of experiencing a terminal event depends
on treatment and covariates. The object carry its own call and
have a <code>predictRisk</code> method. See examples.</p></dd>


<dt>treatment</dt>
<dd><p>Treatment model which describes how the probability of being allocated to a treatment group depends
on covariates. The object must be a <code>glm</code> object (logistic regression) or the name of the treatment variable.
See examples.</p></dd>


<dt>censor</dt>
<dd><p>Censoring model which describes how the probability of being censored depends
on treatment and covariates. The object must be a <code>coxph</code> or <code>cph</code> object. See examples.</p></dd>


<dt>data</dt>
<dd><p>[data.frame or data.table] Data set in which to evaluate risk predictions
based on the outcome model</p></dd>


<dt>data.index</dt>
<dd><p>[numeric vector] Position of the observation in argument data relative to the dataset used to obtain the argument event, treatment, censor.
Only necessary for the standard errors when computing the Average Treatment Effects on a subset of the data set.</p></dd>


<dt>formula</dt>
<dd><p>For analyses with time-dependent covariates, the response formula. See examples.</p></dd>


<dt>estimator</dt>
<dd><p>[character] The type of estimator used to compute the average treatment effect. 
Can be <code>"G-formula"</code>, <code>"IPTW"</code>, or <code>"AIPTW"</code>.
When using <code>estimator="G-formula"</code>, a model for the outcome should be provided (argument event).
When using <code>estimator="IPTW"</code>, a model for the treatment should be provided (argument treatment), as well as for the censoring (if any, argument censor).
When using <code>estimator="AIPTW"</code> (double robust estimator), a model for the outcome and the treatment should be provided (argument event and treatment), as well as for the censoring (if any, argument censor).</p></dd>


<dt>strata</dt>
<dd><p>[character] Strata variable on which to compute the average risk.
Incompatible with treatment. Experimental.</p></dd>


<dt>contrasts</dt>
<dd><p>[character vector] levels of the treatment variable for which the risks should be assessed and compared. Default is to consider all levels.</p></dd>


<dt>allContrasts</dt>
<dd><p>[2-row character matrix] levels of the treatment variable to be compared. Default is to consider all pairwise comparisons.</p></dd>


<dt>times</dt>
<dd><p>[numeric vector] Time points at which to evaluate average treatment effects.</p></dd>


<dt>cause</dt>
<dd><p>[integer/character] the cause of interest.</p></dd>


<dt>landmark</dt>
<dd><p>for models with time-dependent covariates the landmark time(s) of evaluation.
In this case, argument <code>time</code> may only be one value and for the prediction of risks
it is assumed that that the covariates do not change between landmark and landmark+time.</p></dd>


<dt>se</dt>
<dd><p>[logical] If <code>TRUE</code> compute and add the standard errors to the output.</p></dd>


<dt>iid</dt>
<dd><p>[logical] If <code>TRUE</code> compute and add the influence function to the output.</p></dd>


<dt>known.nuisance</dt>
<dd><p>[logical] If <code>FALSE</code> the uncertainty related to the estimation of the nuisance parameters is ignored.
This greatly simplifies computations but requires to use a double robust estimator.
The resulting standard error is known to be consistent when all event, treatment, and censoring models are valid.</p></dd>


<dt>band</dt>
<dd><p>[logical] If <code>TRUE</code> compute and add the quantiles for the confidence bands to the output.</p></dd>


<dt>B</dt>
<dd><p>[integer, &gt;0] the number of bootstrap replications used to compute the confidence intervals.
If it equals 0, then the influence function is used to compute Wald-type confidence intervals/bands.</p></dd>


<dt>seed</dt>
<dd><p>[integer, &gt;0] sed number used to generate seeds for bootstrap
and to achieve reproducible results.</p></dd>


<dt>handler</dt>
<dd><p>[character] Parallel handler for bootstrap. 
<code>"foreach"</code> is the default and the only option on Windows. It uses <code>parallel</code> to create a cluster.
Other operating systems can use <code>"mclapply"</code>.
This argument is ignored when <code>mc.cores=1</code> and <code>cl=NULL</code>.</p></dd>


<dt>mc.cores</dt>
<dd><p>[integer, &gt;0] The number of cores to use,
i.e., the upper limit for the number of child processes that run simultaneously.
Passed to <code><a href="https://rdrr.io/r/parallel/mclapply.html" class="external-link">parallel::mclapply</a></code> or <code><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">parallel::makeCluster</a></code>.
The option is initialized from environment variable mc_cores if set.</p></dd>


<dt>cl</dt>
<dd><p>A parallel socket cluster used to perform cluster calculation in parallel (output by <code><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">parallel::makeCluster</a></code>).
The packages necessary to run the computations (e.g. riskRegression) must already be loaded on each worker.
Only used when <code>handler="foreach"</code>.</p></dd>


<dt>verbose</dt>
<dd><p>[logical] If <code>TRUE</code> inform about estimated run time.</p></dd>


<dt>...</dt>
<dd><p>passed to predictRisk</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Brice Maxime Hugues Ozenne, Thomas Harder Scheike, Laila Staerk, and Thomas
   Alexander Gerds. On the estimation of average treatment effects with right-
   censored time to event outcome and competing risks. Biometrical Journal, 62
   (3):751--763, 2020.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="https://Rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></code> to extract the estimates in a <code>data.table</code> object.
<code><a href="autoplot.ate.html">autoplot.ate</a></code> for a graphical representation the standardized risks.
<code><a href="confint.ate.html">confint.ate</a></code> to compute (pointwise/simultaneous) confidence intervals and (unadjusted/adjusted) p-values, possibly using a transformation.
<code><a href="summary.ate.html">summary.ate</a></code> for a table containing the standardized risks over time and treatment/strata.</p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Brice Ozenne <a href="mailto:broz@sund.ku.dk">broz@sund.ku.dk</a>
and Thomas Alexander Gerds <a href="mailto:tag@biostat.ku.dk">tag@biostat.ku.dk</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://hbiostat.org/R/rms/" class="external-link">rms</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">prodlim</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#### Survival settings  ####</span></span></span>
<span class="r-in"><span><span class="co">#### ATE with Cox model ####</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## generate data</span></span></span>
<span class="r-in"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">100</span></span></span>
<span class="r-in"><span><span class="va">dtS</span> <span class="op">&lt;-</span> <span class="fu"><a href="sampleData.html">sampleData</a></span><span class="op">(</span><span class="va">n</span>, outcome<span class="op">=</span><span class="st">"survival"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dtS</span><span class="op">$</span><span class="va">time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">dtS</span><span class="op">$</span><span class="va">time</span>,<span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dtS</span><span class="op">$</span><span class="va">X1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span>,<span class="fl">0.4</span><span class="op">)</span> , size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"T"</span>,<span class="fl">0</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## estimate the Cox model</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/cph.html" class="external-link">cph</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">event</span><span class="op">)</span><span class="op">~</span> <span class="va">X1</span><span class="op">+</span><span class="va">X2</span>,data<span class="op">=</span><span class="va">dtS</span>,y<span class="op">=</span><span class="cn">TRUE</span>,x<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## compute the ATE at times 5, 6, 7, and 8 using X1 as the treatment variable</span></span></span>
<span class="r-in"><span><span class="co">## standard error computed using the influence function</span></span></span>
<span class="r-in"><span><span class="co">## confidence intervals / p-values based on asymptotic results</span></span></span>
<span class="r-in"><span><span class="va">ateFit1a</span> <span class="op">&lt;-</span> <span class="fu">ate</span><span class="op">(</span><span class="va">fit</span>, data <span class="op">=</span> <span class="va">dtS</span>, treatment <span class="op">=</span> <span class="st">"X1"</span>, times <span class="op">=</span> <span class="fl">5</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Input variables </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Treatment            : X1 (3 levels: "T0" "T1" "T2")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Event                : event (cause: 1, censoring: 0)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Time  [min;max]      : time [0.6;15.7]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Eval. time           :  5  6  7  8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       number at risk T0   16 13 10  7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       number at risk T1   26 21 18 11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       number at risk T2    7  3  3  1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Estimation procedure </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Estimator  : G-formula</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Uncertainty: Gaussian approximation </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 where the variance is estimated via the influence function </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Processing</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Prepare influence function: outcome done </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Point estimation: done </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Decomposition iid: done</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Confidence intervals: done</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ateFit1a</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Average treatment effect </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Treatment            : X1 (3 levels: "T0" "T1" "T2")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Event                : event (cause: 1, censoring: 0)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Time  [min;max]      : time [0.6;15.7]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Eval. time           :  5  6  7  8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       number at risk T0   16 13 10  7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       number at risk T1   26 21 18 11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       number at risk T2    7  3  3  1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Estimation procedure </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Estimator  : G-formula</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Uncertainty: Gaussian approximation </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 where the variance is estimated via the influence function </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Testing procedure</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Null hypothesis     : given two treatments (A,B) and a specific timepoint, equal risks </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Confidence level    : 0.95</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Results: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Difference in standardized risk (B-A) between time zero and 'time' </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 reported on the scale [-1;1] (difference between two probabilities)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  (difference in average risks when treating all subjects with the experimental treatment (B),</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                 vs. treating all subjects with the reference treatment (A))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  time X1=A risk(X1=A) X1=B risk(X1=B) difference           ci p.value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     5   T0      0.472   T1      0.389    -0.0825 [-0.25;0.09]   0.341</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     6   T0      0.550   T1      0.461    -0.0896 [-0.27;0.09]   0.341</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     7   T0      0.609   T1      0.516    -0.0930 [-0.28;0.10]   0.339</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     8   T0      0.641   T1      0.547    -0.0941 [-0.29;0.10]   0.338</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     5   T0      0.472   T2      0.448    -0.0239 [-0.26;0.21]   0.841</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     6   T0      0.550   T2      0.525    -0.0256 [-0.28;0.22]   0.841</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     7   T0      0.609   T2      0.583    -0.0263 [-0.28;0.23]   0.841</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     8   T0      0.641   T2      0.615    -0.0264 [-0.29;0.23]   0.841</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     5   T1      0.389   T2      0.448     0.0586 [-0.17;0.29]   0.612</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     6   T1      0.461   T2      0.525     0.0639 [-0.18;0.31]   0.611</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     7   T1      0.516   T2      0.583     0.0667 [-0.19;0.32]   0.609</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     8   T1      0.547   T2      0.615     0.0677 [-0.19;0.33]   0.608</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  difference      : estimated difference in standardized risks </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ci              : pointwise confidence intervals </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  p.value         : (unadjusted) p-value </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ateFit1a</span>, short <span class="op">=</span> <span class="cn">TRUE</span>, type <span class="op">=</span> <span class="st">"meanRisk"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Standardized risk between time zero and 'time'</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  time X1  risk          ci</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     5 T0 0.472 [0.33;0.62]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     6 T0 0.550 [0.40;0.70]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     7 T0 0.609 [0.46;0.76]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     8 T0 0.641 [0.49;0.79]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     5 T1 0.389 [0.26;0.52]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     6 T1 0.461 [0.33;0.59]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     7 T1 0.516 [0.38;0.66]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     8 T1 0.547 [0.41;0.69]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     5 T2 0.448 [0.25;0.65]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     6 T2 0.525 [0.31;0.74]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     7 T2 0.583 [0.36;0.80]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     8 T2 0.615 [0.39;0.84]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ateFit1a</span>, short <span class="op">=</span> <span class="cn">TRUE</span>, type <span class="op">=</span> <span class="st">"diffRisk"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Difference in standardized risk (B-A) between time zero and 'time' </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  time X1=A X1=B difference           ci p.value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     5   T0   T1    -0.0825 [-0.25;0.09]   0.341</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     6   T0   T1    -0.0896 [-0.27;0.09]   0.341</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     7   T0   T1    -0.0930 [-0.28;0.10]   0.339</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     8   T0   T1    -0.0941 [-0.29;0.10]   0.338</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     5   T0   T2    -0.0239 [-0.26;0.21]   0.841</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     6   T0   T2    -0.0256 [-0.28;0.22]   0.841</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     7   T0   T2    -0.0263 [-0.28;0.23]   0.841</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     8   T0   T2    -0.0264 [-0.29;0.23]   0.841</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     5   T1   T2     0.0586 [-0.17;0.29]   0.612</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     6   T1   T2     0.0639 [-0.18;0.31]   0.611</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     7   T1   T2     0.0667 [-0.19;0.32]   0.609</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     8   T1   T2     0.0677 [-0.19;0.33]   0.608</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ateFit1a</span>, short <span class="op">=</span> <span class="cn">TRUE</span>, type <span class="op">=</span> <span class="st">"ratioRisk"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Ratio of standardized risks (B/A) between time zero and 'time' </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  time X1=A X1=B ratio          ci p.value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     5   T0   T1 0.825 [0.50;1.15]   0.293</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     6   T0   T1 0.837 [0.53;1.14]   0.295</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     7   T0   T1 0.847 [0.56;1.14]   0.299</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     8   T0   T1 0.853 [0.58;1.13]   0.301</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     5   T0   T2 0.949 [0.46;1.43]   0.838</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     6   T0   T2 0.953 [0.51;1.40]   0.839</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     7   T0   T2 0.957 [0.54;1.37]   0.839</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     8   T0   T2 0.959 [0.56;1.36]   0.839</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     5   T1   T2 1.150 [0.54;1.76]   0.628</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     6   T1   T2 1.139 [0.58;1.69]   0.624</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     7   T1   T2 1.129 [0.62;1.64]   0.622</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     8   T1   T2 1.124 [0.63;1.61]   0.620</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co">## same as before with in addition the confidence bands / adjusted p-values</span></span></span>
<span class="r-in"><span><span class="co">## (argument band = TRUE)</span></span></span>
<span class="r-in"><span><span class="va">ateFit1b</span> <span class="op">&lt;-</span> <span class="fu">ate</span><span class="op">(</span><span class="va">fit</span>, data <span class="op">=</span> <span class="va">dtS</span>, treatment <span class="op">=</span> <span class="st">"X1"</span>, times <span class="op">=</span> <span class="fl">5</span><span class="op">:</span><span class="fl">8</span>,</span></span>
<span class="r-in"><span>                band <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ateFit1b</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## by default bands/adjuste p-values computed separately for each treatment modality</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ateFit1b</span>, band <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>         se <span class="op">=</span> <span class="cn">FALSE</span>, type <span class="op">=</span> <span class="st">"diffRisk"</span>, short <span class="op">=</span> <span class="cn">TRUE</span>, quantile <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## adjustment over treatment and time using the band argument of confint</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ateFit1b</span>, band <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>       se <span class="op">=</span> <span class="cn">FALSE</span>, type <span class="op">=</span> <span class="st">"diffRisk"</span>, short <span class="op">=</span> <span class="cn">TRUE</span>, quantile <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## confidence intervals / p-values computed using 1000 boostrap samples</span></span></span>
<span class="r-in"><span><span class="co">## (argument se = TRUE and B = 1000) </span></span></span>
<span class="r-in"><span><span class="va">ateFit1c</span> <span class="op">&lt;-</span> <span class="fu">ate</span><span class="op">(</span><span class="va">fit</span>, data <span class="op">=</span> <span class="va">dtS</span>, treatment <span class="op">=</span> <span class="st">"X1"</span>,</span></span>
<span class="r-in"><span>                times <span class="op">=</span> <span class="fl">5</span><span class="op">:</span><span class="fl">8</span>, se <span class="op">=</span> <span class="cn">TRUE</span>, B <span class="op">=</span> <span class="fl">50</span>, handler <span class="op">=</span> <span class="st">"mclapply"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## NOTE: for real applications 50 bootstrap samples is not enough </span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## same but using 2 cpus for generating and analyzing the boostrap samples</span></span></span>
<span class="r-in"><span><span class="co">## (parallel computation, argument mc.cores = 2) </span></span></span>
<span class="r-in"><span><span class="va">ateFit1d</span> <span class="op">&lt;-</span> <span class="fu">ate</span><span class="op">(</span><span class="va">fit</span>, data <span class="op">=</span> <span class="va">dtS</span>, treatment <span class="op">=</span> <span class="st">"X1"</span>,</span></span>
<span class="r-in"><span>                times <span class="op">=</span> <span class="fl">5</span><span class="op">:</span><span class="fl">8</span>, se <span class="op">=</span> <span class="cn">TRUE</span>, B <span class="op">=</span> <span class="fl">50</span>, mc.cores <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## manually defining the cluster to be used</span></span></span>
<span class="r-in"><span><span class="co">## useful when specific packages need to be loaded in each cluster</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rms/man/cph.html" class="external-link">cph</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">event</span><span class="op">)</span><span class="op">~</span> <span class="va">X1</span><span class="op">+</span><span class="va">X2</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/rms/man/rms.trans.html" class="external-link">rcs</a></span><span class="op">(</span><span class="va">X6</span><span class="op">)</span>,data<span class="op">=</span><span class="va">dtS</span>,y<span class="op">=</span><span class="cn">TRUE</span>,x<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">cl</span> <span class="op">&lt;-</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">makeCluster</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/clusterApply.html" class="external-link">clusterEvalQ</a></span><span class="op">(</span><span class="va">cl</span>, <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://hbiostat.org/R/rms/" class="external-link">rms</a></span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">ateFit1e</span> <span class="op">&lt;-</span> <span class="fu">ate</span><span class="op">(</span><span class="va">fit</span>, data <span class="op">=</span> <span class="va">dtS</span>, treatment <span class="op">=</span> <span class="st">"X1"</span>,</span></span>
<span class="r-in"><span>                times <span class="op">=</span> <span class="fl">5</span><span class="op">:</span><span class="fl">8</span>, se <span class="op">=</span> <span class="cn">TRUE</span>, B <span class="op">=</span> <span class="fl">50</span>,</span></span>
<span class="r-in"><span>                handler <span class="op">=</span> <span class="st">"foreach"</span>, cl <span class="op">=</span> <span class="va">cl</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#### Survival settings without censoring ####</span></span></span>
<span class="r-in"><span><span class="co">#### ATE with glm                        ####</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## generate data</span></span></span>
<span class="r-in"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">100</span></span></span>
<span class="r-in"><span><span class="va">dtB</span> <span class="op">&lt;-</span> <span class="fu"><a href="sampleData.html">sampleData</a></span><span class="op">(</span><span class="va">n</span>, outcome<span class="op">=</span><span class="st">"binary"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dtB</span><span class="op">[</span>, <span class="va">X2</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">X2</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            X6       X7          X8           X9          X10 X1 X2 X3 X4 X5 Y</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1: 78.01298 63.96298 -0.56839002 -0.210572124  0.502907735  0  2  1  1  1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   2: 55.52145 54.36513 -0.39144754  0.937064087 -1.374164637  1  1  0  1  1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   3: 43.13798 62.83007  0.64288621 -0.587024900  0.036800035  0  1  0  1  1 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   4: 49.55549 58.65156  0.27620613  0.496585989  0.586200913  1  1  1  1  0 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   5: 79.22190 60.16542 -0.25813305 -0.260201777  0.683943511  0  1  0  0  1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   6: 82.94772 62.76167  1.46582983  1.382226397 -0.568756129  0  1  0  0  1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   7: 38.24775 54.29504 -1.97327590  0.566921974  0.270355642  0  1  1  1  1 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   8: 75.16737 65.93744  0.92010988  0.074845128 -0.541936997  0  1  0  1  1 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   9: 45.05561 61.47713 -0.14907135 -0.910207520  0.402609684  1  1  0  1  1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  10: 42.73213 56.04234  1.23738748 -0.957253179 -0.186589923  0  1  0  1  1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  11: 77.12665 53.30601  0.52738054 -1.278404907  0.642750763  0  1  0  1  0 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  12: 58.88072 69.29504  1.49049279  0.007014031  0.671474957  0  1  0  0  1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  13: 42.79600 66.46572 -0.39243138 -0.180816188 -0.401039690  1  1  0  0  0 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  14: 76.82265 59.70732  0.18796458 -1.139473919  2.165025815  0  1  1  0  0 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  15: 38.35310 65.01524 -0.01127341  0.743817244 -1.395293526  0  1  1  0  1 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  16: 79.90491 66.60928 -1.24592590  0.624441674 -0.170700120  1  1  0  1  0 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  17: 78.05356 68.87915  0.94396826 -1.418233056 -0.169434430  1  2  0  0  1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  18: 57.61872 64.74185  0.45941533  0.933141193 -0.032983385  0  2  1  0  0 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  19: 66.98958 56.33181 -1.65322897  1.150647382  2.388519770  0  1  1  0  1 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  20: 45.24455 60.60105 -0.77341027  0.470029213 -0.990011932  0  2  0  0  0 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  21: 62.02366 59.91564 -0.68975150  0.879631239 -0.101054172  0  1  0  0  1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  22: 57.78682 67.08263  1.67183286 -0.923246979 -1.914149078  0  1  0  0  1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  23: 63.99209 57.24782 -0.09604987  0.251379345 -0.548874372  0  2  1  0  0 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  24: 53.00781 49.67357 -0.79600441 -1.253740771  0.713894914  0  1  0  0  0 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  25: 40.93517 48.01423 -0.22474377 -0.155392632  1.874488735  0  1  1  1  0 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  26: 76.26733 55.95622 -1.26017269  0.517320940  0.794657504  0  1  0  1  1 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  27: 85.67645 65.05618 -1.42640232  0.423064288 -0.094713679  0  1  0  0  1 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  28: 76.45583 53.01383 -2.65363714  1.158858514 -1.347056080  0  2  1  0  0 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  29: 41.69516 68.75821 -1.03865936  1.907944043  0.226424515  0  1  0  1  0 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  30: 68.97958 60.85126  0.57982435  0.122316551  0.024109298  0  1  0  1  1 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  31: 29.92992 56.16979  2.24926361  0.952111614 -1.804701217  0  1  0  0  1 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  32: 55.66421 65.67026 -0.34730097  1.381241504  0.740596491  0  1  0  0  0 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  33: 55.93535 62.49756  0.35892133 -0.688524922 -0.365777394  0  2  1  0  1 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  34: 82.16710 58.59791 -0.56234113 -0.004725565  0.938043750  1  2  0  0  0 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  35: 46.93589 60.39387 -0.96005031  0.706906654 -0.264641308  0  1  0  0  0 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  36: 62.54992 69.20581  0.34253659  0.638144724 -0.166362498  0  1  0  0  1 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  37: 74.74389 59.98933 -1.04648803 -1.787473323 -0.003882510  0  2  0  1  0 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  38: 62.83938 64.19338  0.55333508 -0.205438562  0.435170090  0  1  0  0  1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  39: 83.37981 69.24409 -0.28051870  0.157280300 -0.620020411  0  1  0  1  0 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  40: 63.87927 56.44113 -0.25400123  0.778093954 -0.245762459  0  2  1  0  0 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  41: 82.95381 63.89724  0.99124934  0.445792808 -0.111607545  0  1  0  1  1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  42: 76.77325 55.69664 -0.66035357 -0.067550191  0.520877462  1  1  0  1  0 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  43: 40.11926 49.80686  0.69329156 -1.480497207 -0.258175659  0  2  1  1  1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  44: 62.04355 51.48902  1.52728405 -0.207528914 -0.071121570  0  1  0  1  1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  45: 38.09094 67.44162  0.23695659 -0.319732621  1.149467397  1  1  1  0  1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  46: 54.80713 59.21902  1.17387684  1.289086796 -2.430072886  0  1  0  1  1 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  47: 75.85677 61.97361 -2.48614865  0.072783058 -1.710448011  1  1  0  0  0 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  48: 54.50966 70.09970  1.49742470 -0.005325330  0.258522399  0  1  1  1  0 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  49: 74.42121 56.72927  0.97382087  0.818791435  0.498021292  0  1  0  0  1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  50: 46.25332 62.31992 -0.48411549  0.952465099 -0.049396092  1  1  0  1  0 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  51: 84.39781 61.44562  0.27685067 -1.939096400  1.494676096  0  2  0  0  0 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  52: 66.56635 60.23336 -0.21522285  0.878847068 -2.581771509  0  1  0  0  1 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  53: 47.40846 58.47434  1.70827066 -0.402449468  0.061033497  0  1  0  0  1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  54: 72.80888 56.05802  1.53843123 -0.882386965  0.327749251  1  1  0  1  1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  55: 70.58864 60.25092 -0.23621370  0.612407673  0.128658740  0  2  1  0  1 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  56: 66.74386 58.00998 -2.07643183  1.130871707 -0.496879832  0  1  1  0  0 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  57: 68.62644 57.81581 -0.60569297 -1.636657486  0.432174401  0  1  0  0  1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  58: 87.17309 59.33232  0.95235963  1.083596256  1.412644391  0  1  0  0  0 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  59: 64.16984 59.67586 -1.18769287 -0.085527482 -2.073420227  1  1  0  0  1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  60: 55.56214 62.99941  3.81258034  0.563125323  0.689403226  0  1  0  0  0 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  61: 80.09402 56.00253  0.64648939  0.372485893  0.653175195  0  1  1  1  1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  62: 77.64821 51.11732  0.14886884  1.192991625  0.198049842  0  1  1  1  1 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  63: 48.23083 52.25507 -1.07258069  0.734835251  1.399588371  0  1  1  0  1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  64: 47.79521 66.95377  0.17764396 -1.007523153  0.364184209  0  1  1  0  1 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  65: 79.24335 65.84558 -0.28467953  0.887392638  1.640771446  0  2  1  1  1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  66: 71.57846 53.46988 -0.70952919  0.418746896  1.135271439  0  1  0  0  1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  67: 63.67749 67.78430 -0.72730972  0.298064973 -1.216440410  0  1  0  1  1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  68: 45.57033 64.87571  2.18399129  0.108168399  0.900987013  0  1  1  1  0 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  69: 48.95988 54.12062 -0.42034232  0.040065443 -0.611960104  0  1  0  0  0 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  70: 75.36952 59.78862 -0.13736276  1.471527338  1.131413771  0  2  0  0  1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  71: 68.28876 59.56319 -0.52263565 -1.755814448 -1.156178361  1  1  0  0  1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  72: 49.55450 72.63081  1.46846228 -0.092613881 -1.101728513  1  1  0  0  0 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  73: 65.87922 58.28823  1.58985009  1.237809270  0.577847393  0  1  0  1  1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  74: 74.49191 55.46585 -2.05805583  0.420395072  0.180873659  1  1  0  0  1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  75: 75.77679 54.73128  1.01236094  0.165181742 -1.987922886  0  1  1  0  1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  76: 69.50403 51.95586 -1.34335639 -0.827838810  1.360595187  0  1  1  1  0 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  77: 71.86100 61.13832 -1.76114717  0.205799319 -1.174200340  0  1  0  0  1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  78: 58.22115 57.86385  1.36326293 -0.998953867 -0.937909463  0  1  0  0  0 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  79: 89.64008 61.67966 -0.16707925  0.028508302  1.268314046  0  1  1  1  0 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  80: 57.88654 67.50344 -0.70818084  0.721889354  1.364005221  0  1  0  0  1 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  81: 76.41378 57.91319  0.28394300  0.203508820 -1.842217474  0  1  1  1  0 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  82: 45.59080 63.00873 -0.20854356 -0.249387100 -0.564817488  0  1  0  1  0 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  83: 85.35118 57.55862  0.04651940  2.071403671 -1.659969104  0  1  1  1  1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  84: 47.72356 63.82289 -1.22547324 -0.982768991  1.252569834  0  2  0  1  0 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  85: 57.45616 55.32343  0.49211534  0.242662434 -1.632399936  0  1  0  0  0 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  86: 57.45603 62.65382  2.22979453  0.003371298  1.053663270  0  1  0  0  1 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  87: 31.38942 60.23798  2.85804162 -1.551135977 -2.768705694  0  1  0  0  0 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  88: 57.83100 60.00459  0.99843840  1.222690877 -1.781053425  0  1  1  1  0 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  89: 65.89807 54.67264 -0.06623606 -0.374327714  0.256339139  0  1  1  0  1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  90: 49.53415 51.54923 -1.54889847  0.032008937  0.005456635  1  1  1  1  0 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  91: 64.49913 69.79595  0.32266619 -0.230910497  0.741769953  0  1  0  1  1 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  92: 40.62557 62.61934  0.25213485 -0.277975908 -2.685602399  0  1  0  0  0 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  93: 64.88648 59.03623  0.69127232 -1.339535295  1.101621330  0  1  0  1  1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  94: 66.47275 64.78869  1.18338315 -0.834602773  1.218020447  0  1  0  1  1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  95: 51.23077 60.85499 -1.53210388  0.331266844  1.501020579  0  1  0  1  0 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  96: 76.13213 51.24694  1.32356115 -0.861312945 -1.185903183  0  1  0  1  0 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  97: 80.60242 65.63773  0.81922078  0.441595794 -1.421862105  0  1  1  0  1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  98: 67.69269 50.80752  1.80025247  0.730770391 -0.487275186  1  2  0  0  1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  99: 54.35984 57.30480 -1.61885892  1.378323304  0.589980565  0  1  0  0  1 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 100: 82.50348 56.96561 -0.01577496  0.481238079 -0.454240463  0  1  0  1  0 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            X6       X7          X8           X9          X10 X1 X2 X3 X4 X5 Y</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## estimate a logistic regression model</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">Y</span> <span class="op">~</span> <span class="va">X1</span><span class="op">+</span><span class="va">X2</span>, data<span class="op">=</span><span class="va">dtB</span>, family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## compute the ATE using X1 as the treatment variable</span></span></span>
<span class="r-in"><span><span class="co">## only point estimate (argument se = FALSE)</span></span></span>
<span class="r-in"><span><span class="va">ateFit1a</span> <span class="op">&lt;-</span> <span class="fu">ate</span><span class="op">(</span><span class="va">fit</span>, data <span class="op">=</span> <span class="va">dtB</span>, treatment <span class="op">=</span> <span class="st">"X1"</span>, se <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Input variables </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Treatment            : X1 (2 levels: "0" "1")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Event                : Y (cause: 1, competing risk(s): 0)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Estimation procedure </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Estimator  : G-formula</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Processing</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Point estimation: done </span>
<span class="r-in"><span><span class="va">ateFit1a</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Average treatment effect for cause 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Treatment            : X1 (2 levels: "0" "1")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Event                : Y (cause: 1, competing risk(s): 0)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Estimation procedure </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Estimator  : G-formula</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Results </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Standardized risks   :                </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  X1=A X1=B    risk.A    risk.B difference (B-A) ratio (B/A)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     0    1 0.5853676 0.9444428        0.3590752    1.613418</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Computation time     : 0.01162887 secs (point estimate)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co">## with confidence intervals</span></span></span>
<span class="r-in"><span><span class="va">ateFit1b</span> <span class="op">&lt;-</span> <span class="fu">ate</span><span class="op">(</span><span class="va">fit</span>, data <span class="op">=</span> <span class="va">dtB</span>, treatment <span class="op">=</span> <span class="st">"X1"</span>,</span></span>
<span class="r-in"><span>               times <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="co">## just for having a nice output not used in computations</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ateFit1b</span>, short <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## using the lava package</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://kkholst.github.io/lava/" class="external-link">lava</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ateLava</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://kkholst.github.io/lava/reference/estimate.default.html" class="external-link">estimate</a></span><span class="op">(</span><span class="va">fit</span>, <span class="kw">function</span><span class="op">(</span><span class="va">p</span>, <span class="va">data</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="va">p</span><span class="op">[</span><span class="st">"(Intercept)"</span><span class="op">]</span> ; <span class="va">b</span> <span class="op">&lt;-</span> <span class="va">p</span><span class="op">[</span><span class="st">"X11"</span><span class="op">]</span> ; <span class="va">c</span> <span class="op">&lt;-</span> <span class="va">p</span><span class="op">[</span><span class="st">"X2"</span><span class="op">]</span> ;</span></span>
<span class="r-in"><span><span class="va">R.X11</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://kkholst.github.io/lava/reference/internal.html" class="external-link">expit</a></span><span class="op">(</span><span class="va">a</span> <span class="op">+</span> <span class="va">b</span> <span class="op">+</span> <span class="va">c</span> <span class="op">*</span> <span class="va">data</span><span class="op">[[</span><span class="st">"X2"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">R.X10</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://kkholst.github.io/lava/reference/internal.html" class="external-link">expit</a></span><span class="op">(</span><span class="va">a</span> <span class="op">+</span> <span class="va">c</span> <span class="op">*</span> <span class="va">data</span><span class="op">[[</span><span class="st">"X2"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>risk0<span class="op">=</span><span class="va">R.X10</span>,risk1<span class="op">=</span><span class="va">R.X11</span>,riskdiff<span class="op">=</span><span class="va">R.X11</span><span class="op">-</span><span class="va">R.X10</span><span class="op">)</span><span class="op">}</span>,</span></span>
<span class="r-in"><span>average<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ateLava</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## see wglm for handling right-censoring with glm</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#### Competing risks settings               ####</span></span></span>
<span class="r-in"><span><span class="co">#### ATE with cause specific Cox regression ####</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## generate data</span></span></span>
<span class="r-in"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">500</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="sampleData.html">sampleData</a></span><span class="op">(</span><span class="va">n</span>, outcome<span class="op">=</span><span class="st">"competing.risks"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dt</span><span class="op">$</span><span class="va">X1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>,<span class="fl">0.3</span><span class="op">)</span> , size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"T"</span>,<span class="fl">0</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## estimate cause specific Cox model</span></span></span>
<span class="r-in"><span><span class="va">fitCR</span> <span class="op">&lt;-</span>  <span class="fu"><a href="CSC.html">CSC</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/prodlim/man/Hist.html" class="external-link">Hist</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">event</span><span class="op">)</span><span class="op">~</span> <span class="va">X1</span><span class="op">+</span><span class="va">X8</span>,data<span class="op">=</span><span class="va">dt</span>,cause<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## compute the ATE at times 1, 5, 10 using X1 as the treatment variable</span></span></span>
<span class="r-in"><span><span class="va">ateFit2a</span> <span class="op">&lt;-</span> <span class="fu">ate</span><span class="op">(</span><span class="va">fitCR</span>, data <span class="op">=</span> <span class="va">dt</span>, treatment <span class="op">=</span> <span class="st">"X1"</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">5</span>,<span class="fl">10</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                cause <span class="op">=</span> <span class="fl">1</span>, se <span class="op">=</span> <span class="cn">TRUE</span>, band <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Input variables </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Treatment            : X1 (3 levels: "T0" "T1" "T2")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Event                : event (cause: 1, competing risk(s): 2, censoring: 0)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Time  [min;max]      : time [0.0839;19.1]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Eval. time           :   1   5 10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       number at risk T0   263 106 12</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       number at risk T1   160  57 11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       number at risk T2    26  15  3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Estimation procedure </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Estimator  : G-formula</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Uncertainty: Gaussian approximation </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 where the variance is estimated via the influence function </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Processing</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Prepare influence function: outcome done </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Point estimation: done </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Decomposition iid: done</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Confidence intervals / bands: done</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ateFit2a</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Average treatment effect for cause 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Treatment            : X1 (3 levels: "T0" "T1" "T2")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Event                : event (cause: 1, competing risk(s): 2, censoring: 0)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Time  [min;max]      : time [0.0839;19.1]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Eval. time           :   1   5 10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       number at risk T0   263 106 12</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       number at risk T1   160  57 11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       number at risk T2    26  15  3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Estimation procedure </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Estimator  : G-formula</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Uncertainty: Gaussian approximation </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 where the variance is estimated via the influence function </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Testing procedure</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Null hypothesis     : given two treatments (A,B), equal risks at all timepoints </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Confidence level    : 0.95</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Multiple comparisons: single-step max-T adjustment computed using 10000 simulations</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Results: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - Difference in standardized risk (B-A) between time zero and 'time' </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 reported on the scale [-1;1] (difference between two probabilities)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  (difference in average risks when treating all subjects with the experimental treatment (B),</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                 vs. treating all subjects with the reference treatment (A))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  time X1=A risk(X1=A) X1=B risk(X1=B) difference           ci p.value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     1   T0     0.0673   T1     0.0681   8.72e-04 [-0.02;0.02]   0.926</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     5   T0     0.3744   T1     0.3743  -2.52e-05 [-0.08;0.08]   1.000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    10   T0     0.5017   T1     0.4935  -8.21e-03 [-0.10;0.09]   0.867</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     1   T0     0.0673   T2     0.0523  -1.49e-02 [-0.05;0.02]   0.355</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     5   T0     0.3744   T2     0.3063  -6.81e-02 [-0.22;0.09]   0.388</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    10   T0     0.5017   T2     0.4253  -7.64e-02 [-0.27;0.12]   0.434</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     1   T1     0.0681   T2     0.0523  -1.58e-02 [-0.05;0.02]   0.346</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     5   T1     0.3743   T2     0.3063  -6.80e-02 [-0.23;0.09]   0.404</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    10   T1     0.4935   T2     0.4253  -6.82e-02 [-0.27;0.13]   0.498</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  simultaneous ci adjusted p.value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     [-0.02;0.02]            0.987</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     [-0.09;0.09]            1.000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     [-0.11;0.09]            0.953</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     [-0.05;0.02]            0.419</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     [-0.23;0.10]            0.454</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     [-0.28;0.13]            0.507</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     [-0.05;0.02]            0.409</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     [-0.24;0.10]            0.472</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     [-0.28;0.14]            0.581</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  difference      : estimated difference in standardized risks </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ci              : pointwise confidence intervals </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  p.value         : (unadjusted) p-value </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  simultaneous ci : simulatenous confidence intervals over time</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  adjusted p.value: p-value adjusted for multiple comparisons over time</span>
<span class="r-in"><span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">ateFit2a</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          type estimator time level      estimate          se       lower</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1:  meanRisk  GFORMULA    1    T0  6.725075e-02 0.012050231  0.04363273</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  2:  meanRisk  GFORMULA    5    T0  3.743564e-01 0.027863621  0.31974466</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  3:  meanRisk  GFORMULA   10    T0  5.017158e-01 0.032588024  0.43784440</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  4:  meanRisk  GFORMULA    1    T1  6.812318e-02 0.012567904  0.04349054</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  5:  meanRisk  GFORMULA    5    T1  3.743311e-01 0.034694830  0.30633052</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  6:  meanRisk  GFORMULA   10    T1  4.935039e-01 0.039653201  0.41578504</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  7:  meanRisk  GFORMULA    1    T2  5.232115e-02 0.018006403  0.01702925</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  8:  meanRisk  GFORMULA    5    T2  3.062972e-01 0.075452662  0.15841267</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  9:  meanRisk  GFORMULA   10    T2  4.253305e-01 0.093198889  0.24266407</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10:  diffRisk  GFORMULA    1 T0.T1  8.724303e-04 0.009441589 -0.01763274</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11:  diffRisk  GFORMULA    5 T0.T1 -2.520916e-05 0.041528106 -0.08141880</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12:  diffRisk  GFORMULA   10 T0.T1 -8.211865e-03 0.049084017 -0.10441477</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13:  diffRisk  GFORMULA    1 T0.T2 -1.492961e-02 0.016145110 -0.04657344</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14:  diffRisk  GFORMULA    5 T0.T2 -6.805918e-02 0.078813390 -0.22253059</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15:  diffRisk  GFORMULA   10 T0.T2 -7.638522e-02 0.097706198 -0.26788585</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16:  diffRisk  GFORMULA    1 T1.T2 -1.580204e-02 0.016761368 -0.04865371</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17:  diffRisk  GFORMULA    5 T1.T2 -6.803397e-02 0.081442901 -0.22765912</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18:  diffRisk  GFORMULA   10 T1.T2 -6.817335e-02 0.100625523 -0.26539576</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 19: ratioRisk  GFORMULA    1 T0.T1  1.012973e+00 0.141191244  0.73624304</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20: ratioRisk  GFORMULA    5 T0.T1  9.999327e-01 0.110929211  0.78251540</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21: ratioRisk  GFORMULA   10 T0.T1  9.836324e-01 0.097205064  0.79311401</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 22: ratioRisk  GFORMULA    1 T0.T2  7.780009e-01 0.234968184  0.31747172</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 23: ratioRisk  GFORMULA    5 T0.T2  8.181968e-01 0.206945429  0.41259122</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 24: ratioRisk  GFORMULA   10 T0.T2  8.477520e-01 0.191990382  0.47145777</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 25: ratioRisk  GFORMULA    1 T1.T2  7.680373e-01 0.237987611  0.30159016</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 26: ratioRisk  GFORMULA    5 T1.T2  8.182519e-01 0.211754010  0.40322167</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 27: ratioRisk  GFORMULA   10 T1.T2  8.618585e-01 0.199975344  0.46991406</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          type estimator time level      estimate          se       lower</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          upper quantileBand   lowerBand  upperBand   p.value adj.p.value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  1: 0.09086877     2.317771  0.03932108 0.09518043        NA          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  2: 0.42896804     2.317771  0.30977486 0.43893784        NA          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  3: 0.56558711     2.317771  0.42618418 0.57724733        NA          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  4: 0.09275582     2.300197  0.03921453 0.09703183        NA          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  5: 0.44233176     2.300197  0.29452621 0.45413608        NA          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  6: 0.57122274     2.300197  0.40229373 0.58471405        NA          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  7: 0.08761305     2.173021  0.01319285 0.09144944        NA          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  8: 0.45418167     2.173021  0.14233695 0.47025739        NA          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  9: 0.60799700     2.173021  0.22280739 0.62785368        NA          NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10: 0.01937760     2.077331 -0.01874087 0.02048573 0.9263779      0.9866</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11: 0.08136838     2.077331 -0.08629282 0.08624240 0.9995157      1.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12: 0.08799104     2.077331 -0.11017560 0.09375187 0.8671323      0.9528</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13: 0.01671423     2.100121 -0.04883630 0.01897708 0.3551148      0.4188</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14: 0.08641222     2.100121 -0.23357685 0.09745849 0.3878360      0.4544</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15: 0.11511541     2.100121 -0.28158008 0.12880964 0.4343411      0.5071</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16: 0.01704964     2.101442 -0.05102508 0.01942101 0.3458009      0.4095</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17: 0.09159118     2.101442 -0.23918153 0.10311359 0.4035162      0.4725</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18: 0.12904905     2.101442 -0.27963209 0.14328538 0.4980915      0.5807</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 19: 1.28970255     2.090655  0.71779060 1.30815499 0.9267926      0.9851</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 20: 1.21734992     2.090655  0.76801794 1.23184738 0.9995156      1.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21: 1.17415086     2.090655  0.78041017 1.18685470 0.8662829      0.9563</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 22: 1.23853008     2.011050  0.30546805 1.25053374 0.3447585      0.3916</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 23: 1.22380239     2.011050  0.40201913 1.23437448 0.3796681      0.4292</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 24: 1.22404624     2.011050  0.46164968 1.23385433 0.4277790      0.4786</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 25: 1.23448445     2.024729  0.28617680 1.24989782 0.3297171      0.3747</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 26: 1.23328214     2.024729  0.38950734 1.24699647 0.3907278      0.4408</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 27: 1.25380300     2.024729  0.45696257 1.26675448 0.4896959      0.5518</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          upper quantileBand   lowerBand  upperBand   p.value adj.p.value</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#### Double robust estimator ####</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co">## generate data</span></span></span>
<span class="r-in"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">500</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="sampleData.html">sampleData</a></span><span class="op">(</span><span class="va">n</span>, outcome<span class="op">=</span><span class="st">"competing.risks"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dt</span><span class="op">$</span><span class="va">time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">dt</span><span class="op">$</span><span class="va">time</span>,<span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dt</span><span class="op">$</span><span class="va">X1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.4</span><span class="op">)</span> , size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"T"</span>,<span class="fl">0</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## working models</span></span></span>
<span class="r-in"><span><span class="va">m.event</span> <span class="op">&lt;-</span>  <span class="fu"><a href="CSC.html">CSC</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/prodlim/man/Hist.html" class="external-link">Hist</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">event</span><span class="op">)</span><span class="op">~</span> <span class="va">X1</span><span class="op">+</span><span class="va">X2</span><span class="op">+</span><span class="va">X3</span><span class="op">+</span><span class="va">X5</span><span class="op">+</span><span class="va">X8</span>,data<span class="op">=</span><span class="va">dt</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">m.censor</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">event</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span><span class="op">~</span> <span class="va">X1</span><span class="op">+</span><span class="va">X2</span><span class="op">+</span><span class="va">X3</span><span class="op">+</span><span class="va">X5</span><span class="op">+</span><span class="va">X8</span>,data<span class="op">=</span><span class="va">dt</span>, x <span class="op">=</span> <span class="cn">TRUE</span>, y <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">m.treatment</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">X1</span><span class="op">~</span><span class="va">X2</span><span class="op">+</span><span class="va">X3</span><span class="op">+</span><span class="va">X5</span><span class="op">+</span><span class="va">X8</span>,data<span class="op">=</span><span class="va">dt</span>,family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span>link<span class="op">=</span><span class="st">"logit"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## prediction + average</span></span></span>
<span class="r-in"><span><span class="va">ateRobust</span> <span class="op">&lt;-</span> <span class="fu">ate</span><span class="op">(</span>event <span class="op">=</span> <span class="va">m.event</span>,</span></span>
<span class="r-in"><span>                 treatment <span class="op">=</span> <span class="va">m.treatment</span>,</span></span>
<span class="r-in"><span>                 censor <span class="op">=</span> <span class="va">m.censor</span>,</span></span>
<span class="r-in"><span>                 data <span class="op">=</span> <span class="va">dt</span>, times <span class="op">=</span> <span class="fl">5</span><span class="op">:</span><span class="fl">10</span>, </span></span>
<span class="r-in"><span>                 cause <span class="op">=</span> <span class="fl">1</span>, band <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## compare various estimators</span></span></span>
<span class="r-in"><span><span class="va">ateRobust3</span> <span class="op">&lt;-</span> <span class="fu">ate</span><span class="op">(</span>event <span class="op">=</span> <span class="va">m.event</span>,</span></span>
<span class="r-in"><span>                 treatment <span class="op">=</span> <span class="va">m.treatment</span>,</span></span>
<span class="r-in"><span>                 censor <span class="op">=</span> <span class="va">m.censor</span>,</span></span>
<span class="r-in"><span>                 estimator <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"GFORMULA"</span>,<span class="st">"IPTW"</span>,<span class="st">"AIPTW"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                 data <span class="op">=</span> <span class="va">dt</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>                 cause <span class="op">=</span> <span class="fl">1</span>, se <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setkey.html" class="external-link">setkeyv</a></span><span class="op">(</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">ateRobust3</span>, type <span class="op">=</span> <span class="st">"meanRisk"</span><span class="op">)</span>,<span class="st">"time"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setkey.html" class="external-link">setkeyv</a></span><span class="op">(</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">ateRobust3</span>, type <span class="op">=</span> <span class="st">"diffRisk"</span><span class="op">)</span>,<span class="st">"time"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#### time-dependent covariates ###</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">celltype</span><span class="op">+</span><span class="va">karno</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">trt</span>, <span class="va">veteran</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">vet2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/survSplit.html" class="external-link">survSplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span><span class="va">.</span>, <span class="va">veteran</span>,</span></span>
<span class="r-in"><span>                       cut<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">60</span>, <span class="fl">120</span><span class="op">)</span>, episode <span class="op">=</span><span class="st">"timegroup"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fitTD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">tstart</span>, <span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">celltype</span> <span class="op">+</span><span class="va">karno</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">trt</span>,</span></span>
<span class="r-in"><span>               data<span class="op">=</span> <span class="va">vet2</span>,x<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">16</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">resVet</span> <span class="op">&lt;-</span> <span class="fu">ate</span><span class="op">(</span><span class="va">fitTD</span>,formula<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/prodlim/man/Hist.html" class="external-link">Hist</a></span><span class="op">(</span>entry<span class="op">=</span><span class="va">tstart</span>,time<span class="op">=</span><span class="va">time</span>,event<span class="op">=</span><span class="va">status</span><span class="op">)</span><span class="op">~</span><span class="fl">1</span>,</span></span>
<span class="r-in"><span>          data <span class="op">=</span> <span class="va">vet2</span>, treatment <span class="op">=</span> <span class="st">"celltype"</span>,</span></span>
<span class="r-in"><span>        times<span class="op">=</span><span class="fl">5</span>,verbose<span class="op">=</span><span class="fl">1</span>,</span></span>
<span class="r-in"><span>        landmark <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">30</span>,<span class="fl">60</span>,<span class="fl">90</span><span class="op">)</span>, cause <span class="op">=</span> <span class="fl">1</span>, B <span class="op">=</span> <span class="fl">50</span>, se <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>        band <span class="op">=</span> <span class="cn">FALSE</span>, mc.cores<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">resVet</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">137</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">d</span><span class="op">=</span><span class="fu"><a href="sampleData.html">sampleDataTD</a></span><span class="op">(</span><span class="fl">127</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">d</span><span class="op">[</span>,<span class="va">status</span><span class="op">:=</span><span class="fl">1</span><span class="op">*</span><span class="op">(</span><span class="va">event</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">d</span><span class="op">[</span>,<span class="va">X3</span><span class="op">:=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">X3</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="co">## ignore competing risks</span></span></span>
<span class="r-in"><span><span class="va">cox1TD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">start</span>,<span class="va">time</span>, <span class="va">status</span>,type<span class="op">=</span><span class="st">"counting"</span><span class="op">)</span> <span class="op">~</span> <span class="va">X3</span><span class="op">+</span><span class="va">X5</span><span class="op">+</span><span class="va">X6</span><span class="op">+</span><span class="va">X8</span>,</span></span>
<span class="r-in"><span>                data<span class="op">=</span><span class="va">d</span>, x <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">resTD1</span> <span class="op">&lt;-</span> <span class="fu">ate</span><span class="op">(</span><span class="va">cox1TD</span>,formula<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/prodlim/man/Hist.html" class="external-link">Hist</a></span><span class="op">(</span>entry<span class="op">=</span><span class="va">start</span>,time<span class="op">=</span><span class="va">time</span>,event<span class="op">=</span><span class="va">status</span><span class="op">)</span><span class="op">~</span><span class="fl">1</span>,</span></span>
<span class="r-in"><span>        data <span class="op">=</span> <span class="va">d</span>, treatment <span class="op">=</span> <span class="st">"X3"</span>, contrasts <span class="op">=</span> <span class="cn">NULL</span>,</span></span>
<span class="r-in"><span>        times<span class="op">=</span><span class="fl">.5</span>,verbose<span class="op">=</span><span class="fl">1</span>,</span></span>
<span class="r-in"><span>        landmark <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.5</span>,<span class="fl">1</span><span class="op">)</span>, B <span class="op">=</span> <span class="fl">20</span>, se <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>        band <span class="op">=</span> <span class="cn">FALSE</span>, mc.cores<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">resTD1</span></span></span>
<span class="r-in"><span><span class="co">## account for competing risks</span></span></span>
<span class="r-in"><span><span class="va">cscTD</span> <span class="op">&lt;-</span> <span class="fu"><a href="CSC.html">CSC</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/prodlim/man/Hist.html" class="external-link">Hist</a></span><span class="op">(</span>time<span class="op">=</span><span class="va">time</span>, event<span class="op">=</span><span class="va">event</span>,entry<span class="op">=</span><span class="va">start</span><span class="op">)</span> <span class="op">~</span> <span class="va">X3</span><span class="op">+</span><span class="va">X5</span><span class="op">+</span><span class="va">X6</span><span class="op">+</span><span class="va">X8</span>, data<span class="op">=</span><span class="va">d</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">16</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">resTD</span> <span class="op">&lt;-</span> <span class="fu">ate</span><span class="op">(</span><span class="va">cscTD</span>,formula<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/prodlim/man/Hist.html" class="external-link">Hist</a></span><span class="op">(</span>entry<span class="op">=</span><span class="va">start</span>,time<span class="op">=</span><span class="va">time</span>,event<span class="op">=</span><span class="va">event</span><span class="op">)</span><span class="op">~</span><span class="fl">1</span>,</span></span>
<span class="r-in"><span>        data <span class="op">=</span> <span class="va">d</span>, treatment <span class="op">=</span> <span class="st">"X3"</span>, contrasts <span class="op">=</span> <span class="cn">NULL</span>,</span></span>
<span class="r-in"><span>        times<span class="op">=</span><span class="fl">.5</span>,verbose<span class="op">=</span><span class="fl">1</span>,</span></span>
<span class="r-in"><span>        landmark <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.5</span>,<span class="fl">1</span><span class="op">)</span>, cause <span class="op">=</span> <span class="fl">1</span>, B <span class="op">=</span> <span class="fl">20</span>, se <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>        band <span class="op">=</span> <span class="cn">FALSE</span>, mc.cores<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">resTD</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Thomas Alexander Gerds, Johan Sebastian Ohlendorff, Brice Ozenne.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer></div>

  

  

  </body></html>

