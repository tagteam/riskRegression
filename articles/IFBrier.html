<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="riskRegression">
<title>Influence function calculation for Brier score for event time data • riskRegression</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Influence function calculation for Brier score for event time data">
<meta property="og:description" content="riskRegression">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">riskRegression</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2022.09.29</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/IFAUC.html">Derivation of the Influence Function for AUC for competing risk data and survival data</a>
    <a class="dropdown-item" href="../articles/IFBrier.html">Influence function calculation for Brier score for event time data</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/tagteam/riskRegression/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="IFBrier_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Influence function calculation for Brier score for event time data</h1>
                        <h4 data-toc-skip class="author">Johan Sebastian Ohlendorff &amp; Thomas Alexander Gerds</h4>
            
            <h4 data-toc-skip class="date">2022-01-09</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/tagteam/riskRegression/blob/HEAD/vignettes/IFBrier.Rmd" class="external-link"><code>vignettes/IFBrier.Rmd</code></a></small>
      <div class="d-none name"><code>IFBrier.Rmd</code></div>
    </div>

    
    


<!-- for use with Rikkes paper -->

<div class="section level2">
<h2 id="if-calculation">IF Calculation<a class="anchor" aria-label="anchor" href="#if-calculation"></a>
</h2>
<p>To describe the situation with competing risks (and also survival) we introduce a random variable <span class="math inline">\(D\in\{1,2\}\)</span> which indicates the cause (i.e., type of the event) observed at time <span class="math inline">\(T\)</span> such that <span class="math inline">\(D=1\)</span> means that the event of interest occurred, and <span class="math inline">\(D=2\)</span> that a competing risk occurred. As in the survival setting we let <span class="math inline">\(Q\)</span> denote the joint probability measure of the uncensored data, <span class="math inline">\((T,D,X)\sim Q\)</span>, and <span class="math inline">\(P\)</span> the joint probability measure of the right censored data <span class="math inline">\(O=(\tilde{T},\Delta,X) \sim P\)</span> now with <span class="math inline">\(\Delta=D 1_{\{T \leq C\}}\)</span> taking values in the set <span class="math inline">\(\{0,1,2\}\)</span>. We are interested in the following definition of the time-dependent discrimination measure for cause 1. We can easily calculate the influence function for the Brier score, which can be written as: <span class="math display">\[\begin{align*}
\sum_{\delta = 0, 1, 2} \int\left\{1_{\{ t \leq \tau, \delta = 1\}}-R(\tau \mid x)\right\}^{2} W_\tau(z; G) P(d t, \delta, d x)
\end{align*}\]</span> with <span class="math inline">\(W_\tau(z; G) = \frac{I(t \leq \tau, \delta = 1)}{G(t-|x)} + \frac{I(t \leq \tau, \delta=2)}{G(t-|x)} + \frac{I(t &gt; \tau)}{G(\tau |x)}\)</span>. Taking the Gateaux derivative yields, <span class="math display">\[\begin{align*}
&amp; I( \tilde{T}_i \leq \tau, \Delta_i=1)\frac{(1-R(\tau \mid X_i)) ^{2}}{G(\tilde{T}_i- | X_i)} + I( \tilde{T}_i \leq \tau, \Delta_i=2)\frac{R(\tau \mid X_i) ^{2}}{G(\tilde{T}_i- | X_i)} + I( \tilde{T}_i &gt; \tau)\frac{R(\tau \mid X_i) ^{2}}{G(\tau | X_i)} \\
&amp;-Brier \\
&amp;+ \int I(t \leq \tau)(1-R(\tau | x))^2 \frac{f_i(t-,x)}{G(t-|x)}P(dt,1,dx) \\
&amp;+ \int I(t \leq \tau)R(\tau | x) ^2 \frac{f_i(t-,x)}{G(t-|x)}P(dt,2,dx) \\
&amp;+ \int I(t &gt; \tau)R(\tau | x) ^2 \frac{f_i(\tau,x)}{G(\tau|x)}P(dt,dx)
\end{align*}\]</span> Whenever the censoring does not depend on covariates, the two last integrals are easy to estimate. However, when the censoring does depend on the covariates, we can use the tricks mentioned in IFAUC.pdf (see also there to find the definition of <span class="math inline">\(f_i(t,x)\)</span>) to get that, <span class="math display">\[\begin{align*}
&amp;\int I(t &gt; \tau)R(\tau | x) ^2 \frac{f_i(\tau,x)}{G(\tau|x)}P(dt,dx) + \int I(t \leq \tau)(1-R(\tau | x))^2 \frac{f_i(t-,x)}{G(t-|x)}P(dt,1,dx) + \int I(t \leq \tau)R(\tau | x) ^2 \frac{f_i(t-,x)}{G(t-|x)}P(dt,2,dx) \\
&amp;= R(\tau | X_i)^2 S(\tau | X_i)\left(\frac{I(\tilde{T}_i \leq \tau, \Delta_i = 0)}{G(\tilde{T}_i|X_i)S(\tilde{T}_i|X_i)}-\int_0^{\tilde{T}_i \wedge \tau} \frac{1}{G(s|X_i)^2S(s|X_i)^2}P(ds,0|X_i)\right) \\
&amp;+ (1-R(\tau|X_i))^2 \left(\frac{I(\tilde{T}_i \leq \tau, \Delta_i = 0)}{G(\tilde{T}_i|X_i)S(\tilde{T}_i|X_i)}(F_1(\tau|X_i)-F_1(\tilde{T}_i|X_i))-\int_0^{\tilde{T}_i \wedge \tau} \frac{(F_1(\tau|X_i)-F_1(s|X_i))}{G(s|X_i)^2S(s|X_i)^2}P(ds,0|X_i)\right) \\
&amp;+ R(\tau|X_i)^2 \left(\frac{I(\tilde{T}_i \leq \tau, \Delta_i = 0)}{G(\tilde{T}_i|X_i)S(\tilde{T}_i|X_i)}(F_2(\tau|X_i)-F_2(\tilde{T}_i|X_i))-\int_0^{\tilde{T}_i \wedge \tau} \frac{(F_2(\tau|X_i)-F_2(s|X_i))}{G(s|X_i)^2S(s|X_i)^2}P(ds,0|X_i)\right) \\
&amp;= R(\tau | X_i)^2 S(\tau | X_i)\left(\frac{I(\tilde{T}_i \leq \tau, \Delta_i = 0)}{G(\tilde{T}_i|X_i)S(\tilde{T}_i|X_i)}-\int_0^{\tilde{T}_i \wedge \tau} \frac{1}{G(s|X_i)S(s|X_i)}\Lambda_C(ds|X_i)\right) \\
&amp;+ (1-R(\tau|X_i))^2 \left(\frac{I(\tilde{T}_i \leq \tau, \Delta_i = 0)}{G(\tilde{T}_i|X_i)S(\tilde{T}_i|X_i)}(F_1(\tau|X_i)-F_1(\tilde{T}_i|X_i))-\int_0^{\tilde{T}_i \wedge \tau} \frac{(F_1(\tau|X_i)-F_1(s|X_i))}{G(s|X_i)S(s|X_i)}\Lambda_C(ds|X_i)\right) \\
&amp;+ R(\tau|X_i)^2 \left(\frac{I(\tilde{T}_i \leq \tau, \Delta_i = 0)}{G(\tilde{T}_i|X_i)S(\tilde{T}_i|X_i)}(F_2(\tau|X_i)-F_2(\tilde{T}_i|X_i))-\int_0^{\tilde{T}_i \wedge \tau} \frac{(F_2(\tau|X_i)-F_2(s|X_i))}{G(s|X_i)S(s|X_i)}\Lambda_C(ds|X_i)\right) 
\end{align*}\]</span> Here we used that <span class="math display">\[
 f_i(t,z) = \frac{\mathbbm{1}_{\{\tilde{T_i} \leq t, \Delta_i = 0\}} \delta_{Z_i}(z)}{G(\tilde{T_i}|Z_i)S(\tilde{T_i}|Z_i)} -\int_0^{\tilde{T}_i \wedge t} \frac{ \delta_{Z_i}(z)dP(s,0 | z)}{G(s|Z_i)^2S(s|Z_i)^2}
\]</span></p>
</div>
<div class="section level2">
<h2 id="if-with-cross-validation">IF with cross-validation<a class="anchor" aria-label="anchor" href="#if-with-cross-validation"></a>
</h2>
<div class="section level3">
<h3 id="binary-case">Binary case<a class="anchor" aria-label="anchor" href="#binary-case"></a>
</h3>
<p>Our cross-validation algorithm repeatedly splits the dataset <span class="math inline">\(D_n\)</span> of size <span class="math inline">\(n\)</span> into training and validation datasets as follows. Let <span class="math inline">\(B\)</span> be a large integer. For each <span class="math inline">\(b=1,\ldots,B\)</span> we draw a bootstrap dataset <span class="math inline">\(D^*_{m,b}=\{O_{b,1}^*,\ldots,O_{b,m}^*\}\)</span> of size <span class="math inline">\(m\le n\)</span> with or without replacement from the data <span class="math inline">\(D_n\)</span>. For <span class="math inline">\(i=1,\ldots,n\)</span> let <span class="math inline">\(N_i^b\)</span> be the number of times subject <span class="math inline">\(i\)</span> is included in <span class="math inline">\(D^*_{m,b}\)</span>. For subsampling bootstrap (without replacement), <span class="math inline">\(N_i^b\)</span> is either 0 or 1. In step <span class="math inline">\(b\)</span> of the cross-validation algorithm the bootstrap dataset <span class="math inline">\(D^*_{m,b}\)</span> is used for training. We apply <span class="math inline">\(R\)</span> to <span class="math inline">\(D^*_{m,b}\)</span> to obtain the prediction model <span class="math inline">\(\ensuremath{R(D_{m,b}^*)}\)</span>. All subjects <span class="math inline">\(i\)</span> for which <span class="math inline">\(N_i^b=0\)</span> are out-of-bag and we let these subjects form the validation dataset of step <span class="math inline">\(b\)</span>.</p>
<p>We now calculate the influence function in the case with binary outcome data <span class="math inline">\((Y\in \{0,1\}\)</span>. In this case, we consider the following functional which describes the expected Brier score of the model <span class="math inline">\(R\)</span> on average across all possible training datasets <span class="math inline">\(D_m\)</span> of size <span class="math inline">\(m\)</span>. The expectation is taken with respect to the data of subject <span class="math inline">\(0\)</span>: <span class="math display">\[\begin{align*}
\psi_{m}(P)&amp;=\int\left(\int\cdots\int\left\{y_{0}-R(D_{m})(x_{0})\right\}^2
\prod_{i=1}^m P(d o_i)\right) P(d
o_{0}) \end{align*}\]</span></p>
<p>for some sample size <span class="math inline">\(m &lt; n\)</span>. Let <span class="math display">\[\begin{equation*}
  \omega_{m} (Y_{0},X_{0})=\mathbb{E}_{D_m} [(Y_{0}-R(D_m)(X_{0}))^2 | Y_{0}, X_{0}] 
\end{equation*}\]</span> because then <span class="math inline">\(\psi_{m}(P) = \mathbb{E}_{O_{0}}[\omega_{m} (Y_{0},X_{0})]\)</span>. For estimating <span class="math inline">\(\omega_{\tau,m}\)</span>, we propose to use leave one-out bootstrap estimation: <span class="math display">\[\begin{equation*}
  \hat{\omega}_{m} (Y_i,X_i)=\frac{\sum_{b=1}^B (Y_{i}-R(D_m)(X_{i}))^2I(N_i^b=0) }{\sum_{b=1}^B I(N_i^b=0)}
\end{equation*}\]</span> Finally, the Brier score may then be estimated by leave one-out bootstrap estimation as ´ <span class="math display">\[\begin{equation*}
  \ensuremath{\hat{\psi}^{(1)}_{m}}=\frac{1}{n}\sum_{i=1}^n\hat{\omega}_{m} (Y_i,X_i)
\end{equation*}\]</span> Finally, we also want standard errors of the estimates. For this, we consider the influence function by taking the Gateaux derivative and get: <span class="math display">\[\begin{align} 
  \text{IF}_{\psi}(m;o_k)&amp;=\frac{\partial}{\partial\epsilon}\psi_{m}(P_{\epsilon,k})\Big\vert_{\epsilon=0} \\
  &amp;= \int \frac{\partial}{\partial\epsilon} \left(\int\cdots\int\left\{y_{0}-R(D_{m})(x_{0})\right\}^2 \prod_{i=1}^m \ensuremath{P_{\epsilon,k}}(d o_i)\right) \ensuremath{P_{\epsilon,k}}(d o_{0}) \Big\vert_{\epsilon=0} \\
  &amp;= \int \frac{\partial}{\partial\epsilon} \left(\int\cdots\int\left\{y_{0}-R(D_{m})(x_{0})\right\}^2 \prod_{i=1}^m \ensuremath{P_{\epsilon,k}}(d o_i)\right) \Big\vert_{\epsilon=0}  P(d o_{0}) \\
  &amp;+  \int \left(\int\cdots\int\left\{y_{0}-R(D_{m})(x_{0})\right\}^2 \prod_{i=1}^m P (d o_i)\right) \frac{\partial}{\partial\epsilon} \ensuremath{P_{\epsilon,k}}(d o_{0}) \Big\vert_{\epsilon=0}  \\
  &amp;= \int \sum_{j=1}^m \left(\int\cdots\int\left\{y_{0}-R(D_{m})(x_{0})\right\}^2  \delta_{o_k}(o_j) \prod_{i \neq j} P(d o_i)\right)  P(d o_{0})  - m \psi_{m}(P) \\ %notation???
  &amp;+ \omega_{m} (Y_{k},X_{k})-\psi_{m}(P) \\
  &amp;= \omega_{m} (Y_{k},X_{k})-(m+1) \psi_{m}(P) \\
  &amp;+\int \sum_{j=1}^m \left(\int\cdots\int\left\{y_{0}-R(D_{m})(x_{0})\right\}^2  \delta_{o_k}(o_j) \prod_{i \neq j} P(d o_i)\right)  P(d o_{0}) 
\end{align}\]</span> wherein we used the product rule of differentiation. Note we use the approximation that <span class="math display">\[\int \sum_{j=1}^m \left(\int\cdots\int\left\{y_{0}-R(D_{m})(x_{0})\right\}^2  \delta_{o_k}(o_j) \prod_{i \neq j} (d o_i)\right)  P(d o_{0})  \approx m\psi_{m}(P)\]</span> Then <span class="math display">\[\begin{equation*}
\text{IF}_{\psi}(m;o_k) = \omega_{m} (Y_{k},X_{k}) - \psi_{m}(P)
\end{equation*}\]</span> For estimating the influence function, we suggest the estimator: <span class="math display">\[\begin{align*}
  \widehat{\text{IF}}_{\psi}(m;O_k)&amp;=\hat{\omega}^{(1)}_{m}(Y_k,X_k)-\ensuremath{\hat{\psi}^{(1)}_{m}}
\end{align*}\]</span></p>
</div>
<div class="section level3">
<h3 id="survival-and-competing-risk-case">Survival and competing risk case<a class="anchor" aria-label="anchor" href="#survival-and-competing-risk-case"></a>
</h3>
<p>Let us now try to expand this to the case with (right-censored) survival data, i.e. <span class="math inline">\(O=(T, \Delta, X)\)</span> and let <span class="math inline">\(\bar{O} = (\tilde{T},X)\)</span> denote the true event time, i.e. <span class="math inline">\(T=\min\{\tilde{T}, C\}\)</span> and <span class="math inline">\(\Delta = I(T\leq C)\)</span>, where <span class="math inline">\(C\)</span> is the censoring time. Also let <span class="math inline">\(Y_i = I(\tilde{T} \leq \tau)\)</span> (or <span class="math inline">\(T\)</span>, depending on whichever is the most appropriate), where <span class="math inline">\(\tau\)</span> be some prespecified time point and <span class="math inline">\(\hat G_n\)</span> be an estimate of the censoring distribution <span class="math inline">\(G\)</span> based on <span class="math inline">\(D_n\)</span>. Then we are concerned with the functional <span class="math inline">\(\mu_{\tau, m}\)</span> <span class="math display">\[\begin{equation*}
  \mu_{\tau,m}=\mathbb{E}_{O_{0}}\big[\mathbb{E}_{D_{m}}\big[\{\mathcal{I}_{\{\ensuremath{\tilde{T}}_{0}\leq \tau\}}-\ensuremath{\ensuremath{R_{\tau}}(D_m)}(X_{0})\}^2\big|\ensuremath{\tilde{T}}_{0},X_{0}\big]\big]
\end{equation*}\]</span> By rewriting the above above a bit (i.e. by using standard tricks when rewriting in terms of the observed data), it can be shown that this quantity can be defined in terms of the observed data, i.e. it can be expressed as the value of a statistical functional <span class="math inline">\(\psi_{\tau,m}:\mathcal{P}\to [0,1]\)</span> <span class="math display">\[\begin{align*}
  \psi_{\tau,m}(\ensuremath{\mathrm{P}})&amp;=\int\left(\int\cdots\int\left\{\mathcal{I}_{\{u_{0}\leq\tau\}}-\ensuremath{R_{\tau}}(D_{m})(x_{0})\right\}^2  \prod_{i=1}^m\ensuremath{\mathrm{P}}(\mathrm{d}o_i)\right)\\
   &amp;\qquad\qquad\timesW_\tau(o_{0},\kappa_{\tau,x_{0}}(\ensuremath{\mathrm{P}}))\ensuremath{\mathrm{P}}(\mathrm{d}o_{0})\\&amp;=\mu_{\tau,m}.
\end{align*}\]</span> with <span class="math display">\[\begin{align*}
  W_\tau(X_i,\hat G_n)=\frac{\mathcal{I}_{\{T_i\leq \tau\}}\Delta_i}{\hat G_n(T_i\vert X_i)}+\frac{\mathcal{I}_{\{T_i&gt;\tau\}}}{\hat G_n(\tau\vert X_i)}
\end{align*}\]</span> then this can be estimated in much the same way as before, i.e. as <span class="math display">\[\begin{equation*}
  \ensuremath{\hat{\mu}^{(1)}_{\tau,m}}=\frac{1}{n}\sum_{i=1}^n\hat{\omega}^{(1)}_{\tau,m}(T_i,X_i)W_\tau(X_i,\hat G_n)
\end{equation*}\]</span> Here, we redefine that <span class="math display">\[\begin{equation*}
  \hat{\omega}^{(1)}_{\tau,m}(\ensuremath{\tilde{T}}_i,X_i)=\frac{\sum_{b=1}^B\{\mathcal{I}_{\{\ensuremath{\tilde{T}}_i\leq \tau\}}-\ensuremath{\ensuremath{R_{\tau}}(D_{m,b}^*)}(X_i)\}^2\mathcal{I}_{\{N_i^b=0\}}}{\sum_{b=1}^B\mathcal{I}_{\{N_i^b=0\}}}
\end{equation*}\]</span> In much the same way as before, we may find the the influence function of <span class="math inline">\(\psi_{\tau,m}(\ensuremath{\mathrm{P}})\)</span> to be almost the same as before with an additional term corresponding to the fact that the censoring distribution has to be estimated, i.e.  <span class="math display">\[\begin{align*} 
  \text{IF}_{\psi}(\tau,m;o_k)&amp;=\ensuremath{\omega_{\tau,m}}(t_k,x_k)W_\tau(o_k,\kappa_{\tau,x_{0}}(\ensuremath{\mathrm{P}}))-(m+1)\, \mu_{\tau,m}\\
  &amp;+\int\Big[\sum_{j=1}^m \int\cdots\int\{\mathcal{I}_{\{t_{0}\leq\tau\}}-\ensuremath{R_{\tau}}(\{o_i\}_{i=1}^n)(x_{0})\}^2  \delta_{o_k}(o_j)\prod_{i\neq j}\ensuremath{\mathrm{P}}(\mathrm{d}o_i)\Big]W_\tau(o_{0},\kappa_{\tau,x_{0}}(\ensuremath{\mathrm{P}}))\ensuremath{\mathrm{P}}(\mathrm{d}o_{0})
  \\
  &amp;+\int\ensuremath{\omega_{\tau,m}}(t_{0},x_{0})\left[\frac{\mathcal{I}_{\{t_{0}\leq \tau\}}\delta_{0}}{G(t_{0}-\vert x_{0})} f_k(t_{0},x_{0})
  +\frac{\mathcal{I}_{\{t_{0}&gt;\tau\}}}{G(\tau\vert x_{0})}f_k(\tau,x_{0}) \right]\ensuremath{\mathrm{P}}(\mathrm{d}o_{0}) 
\end{align*}\]</span> We can use the approximation that <span class="math inline">\(\int\Big[\sum_{j=1}^m \int\cdots\int\{\mathcal{I}_{\{t_{0}\leq\tau\}}-\ensuremath{R_{\tau}}(\{o_i\}_{i=1}^n)(x_{0})\}^2 \delta_{o_k}(o_j)\prod_{i\neq j}\ensuremath{\mathrm{P}}(\mathrm{d}o_i)\Big]W_\tau(o_{0},\kappa_{\tau,x_{0}}(\ensuremath{\mathrm{P}}))\ensuremath{\mathrm{P}}(\mathrm{d}o_{0}) \approx m\mu_{\tau,m}\)</span>. Then approximately, <span class="math display">\[\begin{align*} 
  \text{IF}_{\psi}(\tau,m;o_k)&amp;\approx \ensuremath{\omega_{\tau,m}}(t_k,x_k)W_\tau(o_k,\kappa_{\tau,x_{0}}(\ensuremath{\mathrm{P}}))-\, \mu_{\tau,m}\\
  &amp;+\int\ensuremath{\omega_{\tau,m}}(t_{0},x_{0})\left[\frac{\mathcal{I}_{\{t_{0}\leq \tau\}}\delta_{0}}{G(t_{0}-\vert x_{0})} f_k(t_{0},x_{0})
  +\frac{\mathcal{I}_{\{t_{0}&gt;\tau\}}}{G(\tau\vert x_{0})}f_k(\tau,x_{0}) \right]\ensuremath{\mathrm{P}}(\mathrm{d}o_{0}) 
\end{align*}\]</span> This approximation can be justified in the sense that influence functions should have mean zero. This can then be estimated in much the same way as before <span class="math display">\[\begin{align*}
  \widehat{\text{IF}}_{\psi}(\tau,m;O_k)&amp;=\hat{\omega}^{(1)}_{\tau,m}(T_k,X_k)W_\tau(O_k,\hat G_n)-\, \ensuremath{\hat{\mu}^{(1)}_{\tau,m}}\\
  &amp;+\frac{1}{n}\sum_{i=1}^n\hat{\omega}^{(1)}_{\tau,m}(T_i,X_i)\left[\frac{\mathcal{I}_{\{T_i\leq\tau\}}\Delta_i}{\hat G_n(T_i-\vert X_i)}\hat{f_k} (T_i-,X_i)
  +\frac{\mathcal{I}_{\{T_i&gt;\tau\}}}{\hat G_n(\tau\vert X_i)}\hat{f_k} (\tau ,X_i)\right]
\end{align*}\]</span> Here the last term corresponds to the censoring being unknown. Note that this corresponds exactly to estimating as the train-validation case situation with the residuals now being the cross-validated residuals <span class="math inline">\(\hat{\omega}^{(1)}_{\tau,m}(T_k,X_k)W_\tau(O_k,\hat G_n)\)</span>. This is for the survival case; for the competing risk case, we would use <span class="math display">\[\begin{align*}
  \widehat{\text{IF}}_{\psi}(\tau,m;O_k)&amp;=\hat{\omega}^{(1)}_{\tau,m}(T_k,X_k)W_\tau(O_k,\hat G_n)-\, \ensuremath{\hat{\mu}^{(1)}_{\tau,m}}\\
  &amp;+\frac{1}{n}\sum_{i=1}^n\hat{\omega}^{(1)}_{\tau,m}(T_i,X_i)\left[\frac{\mathcal{I}_{\{T_i\leq\tau, \Delta_i = 1\}}}{\hat G_n(T_i-\vert X_i)}\hat{f_k} (T_i-,X_i) + \frac{\mathcal{I}_{\{T_i\leq\tau, \Delta_i = 2\}}}{\hat G_n(T_i-\vert X_i)}\hat{f_k} (T_i-,X_i)
  +\frac{\mathcal{I}_{\{T_i&gt;\tau\}}}{\hat G_n(\tau\vert X_i)}\hat{f_k} (\tau ,X_i)\right]
\end{align*}\]</span> as an estimator.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Thomas Alexander Gerds, Johan Sebastian Ohlendorff, Brice Ozenne.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
